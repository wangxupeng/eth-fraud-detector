# 以太坊交易网络分析系统

[English](README.md) | [中文](README_CN.md)

这是一个基于图神经网络(GNN)的以太坊交易网络分析系统，用于检测可疑的交易地址。该系统通过分析以太坊交易网络的结构和特征，识别潜在的可疑交易地址。

## 项目流程

### 1. 数据获取 (blockchain_data.py)
- 使用 Web3.py 连接以太坊节点
- 获取最近的区块信息（默认获取最近10个区块）
- 提取交易数据，包括：
  - 交易哈希
  - 发送方地址
  - 接收方地址
  - 交易金额
  - 区块号

### 2. 黑名单数据处理 (blacklist_data.py)
- 获取已知的可疑地址列表
- 处理和标准化地址格式
- 构建黑名单数据集

### 3. 网络构建 (network_analysis_full.py)
- 使用 NetworkX 构建交易网络
- 节点：交易地址
- 边：交易关系
- 边权重：交易金额
- 计算网络特征：
  - 度中心性：度中心性是指一个节点的连接数量。入度中心性表示一个节点作为目标节点的连接数量，而出度中心性表示一个节点作为源节点的连接数量。
  - 交易金额统计：统计每个节点的交易金额，包括入账金额和出账金额。入账金额是指一个节点接收到的总金额，而出账金额是指一个节点发送出去的总金额。
  - 交易频率分析：分析每个节点的交易频率，包括入账频率和出账频率。入账频率是指一个节点接收到交易的次数，而出账频率是指一个节点发送交易的次数。

### 4. 图神经网络模型 (gnn_model.py)
- 特征工程：
  - 节点特征：
    - 入度/出度
    - 交易金额统计
    - 交易频率
  - 特征标准化
- 模型架构：
  - 3层GCN
  - 隐藏层维度：64
  - Dropout：0.5
- 训练过程：
  - 早停机制（patience=20）
  - 动态阈值（前10%概率）

### 5. 可视化结果展示

#### 5.1 交易网络结构
![交易网络结构](data/visualizations/network_structure.png)

这个网络图展示了交易地址之间的关系：
- 红色节点：可疑地址
- 蓝色节点：正常地址
- 节点大小：基于交易频率
- 边的粗细：基于交易金额

#### 5.2 可疑度分布热力图
![可疑度分布](data/visualizations/suspicion_heatmap.png)

热力图展示了可疑度的空间分布：
- 红色区域：高可疑度聚集区
- 黄色区域：中等可疑度区域
- 浅色区域：低可疑度区域
- 节点大小反映了交易活跃度

#### 5.3 交易模式分析
![交易模式](data/visualizations/transaction_patterns.png)

散点图展示了地址的交易行为特征：
- X轴：入度（接收交易数）
- Y轴：出度（发送交易数）
- 点的大小：交易总额
- 颜色深浅：可疑度高低

#### 5.4 交互式网络探索
我们还提供了一个交互式的网络探索工具（data/visualizations/draggable_network.html）：
- 支持放大缩小
- 可以拖动节点
- 悬停显示详细信息：
  - 地址
  - 交易频率
  - 交易对手数
  - 交易总额
- 点击节点高亮相关连接

## 安装和使用

1. 安装依赖：
```bash
pip install -r requirements.txt
```

2. 配置环境变量：
```python
# config.py
INFURA_PROJECT_ID = "your_infura_project_id"
INFURA_URL = f"https://mainnet.infura.io/v3/{INFURA_PROJECT_ID}"
BLACKLIST_API_URL = "blacklist_api_url"
```

3. 运行分析：
```bash
python main.py
```

## 项目文件说明

- `blockchain_data.py`: 从以太坊区块链获取交易数据
- `blacklist_data.py`: 获取和处理黑名单地址
- `data_processor.py`: 数据预处理和标准化
- `network_analysis.py`: 基础网络分析功能
- `network_analysis_full.py`: 完整的网络分析实现
- `gnn_model.py`: 图神经网络模型定义和训练
- `config.py`: 配置文件
- `main.py`: 主程序入口
- `requirements.txt`: 项目依赖列表
- `logs/`: 日志文件目录

## 输出结果

系统会在 `logs` 目录下生成分析报告，包含：
1. 训练过程
   - 每轮损失值
   - 早停信息
   - 模型准确率

2. 可疑地址分析
   - 地址信息
   - 可疑度分数
   - 交易统计（入度/出度）
   - 金额统计（入账/出账总额）

## 注意事项

1. 数据获取
   - 需要有效的 Infura API key
   - 建议使用本地缓存减少API调用

2. 性能优化
   - 大规模网络分析耗时较长
   - 建议使用GPU加速（如有）

3. 参数调优
   - 可根据实际数据调整模型参数
   - 可疑度阈值默认设置为前10% 